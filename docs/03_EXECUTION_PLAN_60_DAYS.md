# ğŸš€ MagenAd - ×ª×•×›× ×™×ª ×‘×™×¦×•×¢ 60 ×™×•×

**××™×•× 1 ×¢×“ ××•×¦×¨ ×—×™ ×•××•×›×¨**

---

## ğŸ“‹ ×ª×•×›×Ÿ ×¢× ×™×™× ×™×

1. [×¢×§×¨×•× ×•×ª ×”×ª×•×›× ×™×ª](#1-×¢×§×¨×•× ×•×ª-×”×ª×•×›× ×™×ª)
2. [××‘× ×” ×”×©×‘×•×¢×•×ª](#2-××‘× ×”-×”×©×‘×•×¢×•×ª)
3. [×©×‘×•×¢ 1-2: Foundation](#3-×©×‘×•×¢-1-2-foundation)
4. [×©×‘×•×¢ 3-4: Data & Detection](#4-×©×‘×•×¢-3-4-data--detection)
5. [×©×‘×•×¢ 5-6: Dashboard & Reports](#5-×©×‘×•×¢-5-6-dashboard--reports)
6. [×©×‘×•×¢ 7-8: Testing & Polish](#6-×©×‘×•×¢-7-8-testing--polish)
7. [×©×‘×•×¢ 9: First Clients](#7-×©×‘×•×¢-9-first-clients)
8. [Cursor AI Prompts](#8-cursor-ai-prompts)
9. [Definition of Done](#9-definition-of-done)
10. [Troubleshooting](#10-troubleshooting)

---

## 1. ×¢×§×¨×•× ×•×ª ×”×ª×•×›× ×™×ª

### ×’×™×©×ª ×”×¢×‘×•×“×”

```
ğŸ“¦ ×‘× ×” ×‘×‘×œ×•×§×™×
   â””â”€ ×›×œ ×©×‘×•×¢ = ×‘×œ×•×§ ×¤×•× ×§×¦×™×•× ×œ×™ ×©×œ×

ğŸ§ª ×˜×¡×˜ ×›×œ ×™×•×
   â””â”€ ××œ ×ª×¦×‘×•×¨ ×‘××’×™×

âœ… Definition of Done
   â””â”€ ×œ× ×¢×•×‘×¨×™× ×œ×©×œ×‘ ×”×‘× ×‘×œ×™ ×œ×¡×™×™×

ğŸ¤– ×¢×‘×•×“ ×¢× Cursor
   â””â”€ ×”×©×ª××© ×‘-Prompts ×©×× ×™ × ×•×ª×Ÿ ×œ×š
```

### ×”×›×œ×œ ×”×—×©×•×‘ ×‘×™×•×ª×¨

**âš ï¸ ××œ ×ª×§×¤×•×¥ ×§×“×™××”!**

```
âŒ ×œ× ×‘×•× ×™× Dashboard ×œ×¤× ×™ ×©×™×© API
âŒ ×œ× ×‘×•× ×™× Detection ×œ×¤× ×™ ×©×™×© Data
âŒ ×œ× ××•×¡×™×¤×™× "×¨×§ ×¢×•×“ ×¤×™×¦'×¨ ×§×˜×Ÿ"
```

### ××™×š ×œ×¢×‘×•×“ ×¢× Cursor

```
1. ×§×¨× ××ª ×”-prompt ×”××œ×
2. ×”×¢×ª×§ ×œCursor
3. ×ª×Ÿ ×œ×• ×œ×›×ª×•×‘
4. ×‘×“×•×§ ×©×¢×•×‘×“
5. ×¢×‘×•×¨ ×œ×¤×¨×•××¤×˜ ×”×‘×
```

---

## 2. ××‘× ×” ×”×©×‘×•×¢×•×ª

### Timeline Overview

```
Week 1-2: Foundation (14 ×™××™×)
â”œâ”€ Setup + Auth + Basic API
â”œâ”€ Database + Supabase
â””â”€ Google Ads OAuth

Week 3-4: Data & Detection (14 ×™××™×)
â”œâ”€ Data Ingestion Job
â”œâ”€ Baseline Calculation
â””â”€ Detection Engine

Week 5-6: Dashboard & Reports (14 ×™××™×)
â”œâ”€ React Dashboard
â”œâ”€ Monthly Reports
â””â”€ WhatsApp Integration

Week 7-8: Testing & Polish (14 ×™××™×)
â”œâ”€ Real Data Testing
â”œâ”€ Bug Fixes
â””â”€ UI/UX Polish

Week 9: Launch (4 ×™××™×)
â”œâ”€ First Client Onboarding
â”œâ”€ Monitoring
â””â”€ Iteration
```

### ×™×¢×“×™× ×©×‘×•×¢×™×™×

| ×©×‘×•×¢ | ×™×¢×“ | Success Metric |
|------|-----|----------------|
| 1-2 | ×ª×©×ª×™×ª ××•×›× ×” | ×™×•×–×¨ ×™×›×•×œ ×œ×”×™×¨×©× ×•×œ×”×ª×—×‘×¨ ×œGoogle Ads |
| 3-4 | Data ×–×•×¨× | ×§×œ×™×§×™× × ×©××¨×™× ×‘-DB ×›×œ 6 ×©×¢×•×ª |
| 5-6 | Dashboard ×—×™ | ×™×•×–×¨ ×¨×•××” × ×ª×•× ×™× ×××™×ª×™×™× |
| 7-8 | ×™×¦×™×‘ ×•××œ×•×˜×© | ××¤×¡ ×‘××’×™× ×§×¨×™×˜×™×™× |
| 9 | ×œ×§×•×— ×¨××©×•×Ÿ | 1 ×œ×§×•×— ××©×ª××© ×‘××¢×¨×›×ª |

---

## 3. ×©×‘×•×¢ 1-2: Foundation

### ×™×•× 1: Project Setup

**××˜×¨×”:** ×œ×™×¦×•×¨ ××ª ××‘× ×” ×”×¤×¨×•×™×§×˜ ×”×‘×¡×™×¡×™.

**××©×™××•×ª:**

1. **×¦×•×¨ ×ª×™×§×™×•×ª**
```bash
mkdir magenad
cd magenad
mkdir backend frontend
```

2. **Backend Setup**
```bash
cd backend
npm init -y
npm install express cors dotenv
npm install @supabase/supabase-js
npm install node-cron
npm install --save-dev nodemon
```

3. **Frontend Setup**
```bash
cd ../frontend
npm create vite@latest . -- --template react
npm install @supabase/supabase-js
npm install react-router-dom
npm install tailwindcss postcss autoprefixer
npx tailwindcss init -p
```

4. **Git Init**
```bash
cd ..
git init
echo "node_modules" > .gitignore
echo ".env" >> .gitignore
git add .
git commit -m "Initial setup"
```

**Cursor Prompt:**
```
Create a basic Express server in backend/server.js with:
- CORS enabled
- JSON body parser
- A health check endpoint at GET /api/health
- Listen on port 3001
- Use ES6 import syntax

Also create backend/package.json scripts:
- "start": "node server.js"
- "dev": "nodemon server.js"
```

**Definition of Done:**
- âœ… `npm run dev` ××¨×™×¥ ××ª ×”×©×¨×ª
- âœ… `http://localhost:3001/api/health` ××—×–×™×¨ `{ status: "ok" }`
- âœ… Frontend ×¨×¥ ×¢× `npm run dev`

---

### ×™×•× 2: Supabase Setup

**××˜×¨×”:** ×œ×—×‘×¨ ××ª Supabase ×•×œ×”×’×“×™×¨ Auth.

**××©×™××•×ª:**

1. **×¦×•×¨ Supabase Project**
   - ×œ×š ×œ-https://supabase.com
   - Create New Project
   - ×©××•×¨: `SUPABASE_URL` + `SUPABASE_ANON_KEY`

2. **×”×•×¡×£ .env**
```bash
# backend/.env
SUPABASE_URL=your_url_here
SUPABASE_SERVICE_KEY=your_service_key_here

# frontend/.env
VITE_SUPABASE_URL=your_url_here
VITE_SUPABASE_ANON_KEY=your_anon_key_here
```

3. **×¦×•×¨ Supabase Client**

**Cursor Prompt:**
```
Create backend/services/supabase.js that exports a Supabase client using:
- @supabase/supabase-js
- Load SUPABASE_URL and SUPABASE_SERVICE_KEY from .env
- Use createClient with service role key

Also create frontend/src/lib/supabase.js that exports a client using:
- VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY
- Use createClient for browser
```

**Definition of Done:**
- âœ… Supabase client ××•×’×“×¨ ×‘×©× ×™ ×”×¦×“×“×™×
- âœ… ××™×Ÿ errors ×‘×§×•× ×¡×•×œ
- âœ… `.env` ×‘-gitignore

---

### ×™×•× 3: Database Schema - Part 1

**××˜×¨×”:** ×œ×™×¦×•×¨ ××ª ×˜×‘×œ××•×ª ×”××©×ª××©×™× ×•×”×—×©×‘×•× ×•×ª.

**××©×™××•×ª:**

1. **×¤×ª×— Supabase SQL Editor**

2. **×”×¨×¥ SQL:**

```sql
-- ×˜×‘×œ×ª users (××ª×—×‘×¨×ª ×œ-auth.users)
CREATE TABLE users (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  email TEXT UNIQUE NOT NULL,
  phone TEXT,
  whatsapp_number TEXT,
  full_name TEXT,
  company_name TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  last_login_at TIMESTAMPTZ,
  is_active BOOLEAN DEFAULT TRUE
);

-- Index
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_active ON users(is_active);

-- RLS Policy
ALTER TABLE users ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own data"
ON users FOR SELECT
USING (auth.uid() = id);

CREATE POLICY "Users can update own data"
ON users FOR UPDATE
USING (auth.uid() = id);
```

3. **×˜×‘×œ×ª ad_accounts:**

```sql
CREATE TABLE ad_accounts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  google_customer_id TEXT NOT NULL,
  account_name TEXT,
  
  access_token TEXT,
  refresh_token TEXT,
  token_expires_at TIMESTAMPTZ,
  
  connection_status TEXT DEFAULT 'active',
  last_sync_at TIMESTAMPTZ,
  last_sync_status TEXT,
  last_error_message TEXT,
  
  currency TEXT DEFAULT 'ILS',
  timezone TEXT DEFAULT 'Asia/Jerusalem',
  
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  UNIQUE(user_id, google_customer_id)
);

CREATE INDEX idx_ad_accounts_user ON ad_accounts(user_id);
CREATE INDEX idx_ad_accounts_customer_id ON ad_accounts(google_customer_id);
CREATE INDEX idx_ad_accounts_status ON ad_accounts(connection_status);

-- RLS
ALTER TABLE ad_accounts ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own accounts"
ON ad_accounts FOR SELECT
USING (user_id = auth.uid());

CREATE POLICY "Users can insert own accounts"
ON ad_accounts FOR INSERT
WITH CHECK (user_id = auth.uid());
```

**Definition of Done:**
- âœ… ×˜×‘×œ××•×ª × ×•×¦×¨×• ×‘×”×¦×œ×—×”
- âœ… RLS ×¤×¢×™×œ
- âœ… ××¤×©×¨ ×œ×¨××•×ª ×‘-Supabase Table Editor

---

### ×™×•× 4: Auth - Signup & Login

**××˜×¨×”:** ××©×ª××© ×™×›×•×œ ×œ×”×™×¨×©× ×•×œ×”×ª×—×‘×¨.

**Cursor Prompt - Backend:**
```
Create backend/routes/auth.js with Express router:

POST /signup:
- Accepts: { email, password, full_name, phone }
- Uses supabase.auth.signUp()
- After signup, insert into users table
- Returns: { user, session }

POST /login:
- Accepts: { email, password }
- Uses supabase.auth.signInWithPassword()
- Updates users.last_login_at
- Returns: { user, session }

POST /logout:
- Requires Authorization header
- Uses supabase.auth.signOut()
- Returns: { success: true }

Mount this router in server.js at /api/auth
```

**Cursor Prompt - Frontend:**
```
Create frontend/src/pages/Login.jsx:
- Form with email + password fields
- "Login" and "Sign Up" buttons
- On submit, call supabase.auth.signInWithPassword()
- On success, navigate to /dashboard
- Show error messages if login fails
- Use Tailwind for styling (clean, minimal)

Also create frontend/src/pages/Signup.jsx with:
- Email, password, full name, phone fields
- Call supabase.auth.signUp()
- Redirect to dashboard on success

Create frontend/src/hooks/useAuth.js:
- Custom hook that checks supabase.auth.getSession()
- Returns { user, loading, signOut }
```

**Definition of Done:**
- âœ… ××¤×©×¨ ×œ×”×™×¨×©× ×‘××™×™×œ ×•×¡×™×¡××”
- âœ… ××¤×©×¨ ×œ×”×ª×—×‘×¨
- âœ… Session × ×©××¨ (refresh ×¢×•×‘×“)
- âœ… ××¤×©×¨ ×œ×”×ª× ×ª×§

---

### ×™×•× 5: Google Ads OAuth - Setup

**××˜×¨×”:** ×œ×”×ª×—×™×œ ××ª ×ª×”×œ×™×š ×”×—×™×‘×•×¨ ×œGoogle Ads.

**××©×™××•×ª:**

1. **×¦×•×¨ Google Cloud Project**
   - https://console.cloud.google.com
   - Create Project: "MagenAd"
   - Enable "Google Ads API"

2. **×¦×•×¨ OAuth Credentials**
   - APIs & Services â†’ Credentials
   - Create OAuth Client ID
   - Type: Web Application
   - Authorized redirect URIs: `http://localhost:3001/api/google-ads/callback`
   - ×©××•×¨: `CLIENT_ID` + `CLIENT_SECRET`

3. **×‘×§×© Developer Token**
   - Google Ads â†’ Tools â†’ API Center
   - Apply for Developer Token
   - (×œ×•×§×— 24-48 ×©×¢×•×ª - ×‘×™× ×ª×™×™× ×”×©×ª××© ×‘-test token)

4. **×”×•×¡×£ ×œ-.env:**
```
GOOGLE_CLIENT_ID=your_client_id
GOOGLE_CLIENT_SECRET=your_client_secret
GOOGLE_DEVELOPER_TOKEN=your_dev_token
GOOGLE_REDIRECT_URI=http://localhost:3001/api/google-ads/callback
```

**Cursor Prompt:**
```
Create backend/services/googleAds.js:

Export a function getAuthUrl(userId) that:
- Uses googleapis library (install it)
- Creates OAuth2 client with CLIENT_ID, CLIENT_SECRET, REDIRECT_URI
- Generates auth URL with scopes: ['https://www.googleapis.com/auth/adwords']
- Includes state parameter with userId
- Returns the auth URL

Also create backend/routes/googleAds.js with:

GET /oauth-url:
- Requires auth (check Authorization header)
- Calls getAuthUrl(userId)
- Returns: { auth_url }

GET /callback:
- Receives code and state from query params
- Exchanges code for tokens using OAuth2 client
- Saves tokens to ad_accounts table
- Redirects to frontend with success message
```

**Definition of Done:**
- âœ… `GET /api/google-ads/oauth-url` ××—×–×™×¨ URL
- âœ… ×”URL ×¤×•×ª×— ××ª Google OAuth
- âœ… Callback ××§×‘×œ ××ª ×”×§×•×“

---

### ×™×•× 6: Google Ads OAuth - Complete

**××˜×¨×”:** ×œ×©××•×¨ ××ª ×”×˜×•×§× ×™× ×•×œ×©×œ×•×£ ×—×©×‘×•× ×•×ª.

**Cursor Prompt:**
```
Update backend/services/googleAds.js:

Add function getAccessToken(refreshToken):
- Uses OAuth2 client to refresh token
- Returns new access token

Add function listCustomerAccounts(refreshToken):
- Uses Google Ads API
- Fetches customer accounts accessible with this token
- Returns array of: { customer_id, name }

Update backend/routes/googleAds.js:

POST /connect-account:
- Requires auth
- Accepts: { customer_id, account_name }
- Saves to ad_accounts with user_id
- Returns: { ad_account }

GET /accounts:
- Requires auth
- Returns user's connected ad_accounts
```

**Frontend Prompt:**
```
Create frontend/src/pages/ConnectAccount.jsx:

- Shows "Connect Google Ads" button
- On click, fetch /api/google-ads/oauth-url
- Open URL in popup window
- After OAuth, show list of available accounts
- User selects account and clicks "Connect"
- POST to /api/google-ads/connect-account
- Redirect to dashboard
```

**Definition of Done:**
- âœ… OAuth flow ××œ× ×¢×•×‘×“
- âœ… ×˜×•×§× ×™× × ×©××¨×™× ×‘-DB
- âœ… ×™×•×–×¨ ×¨×•××” ×¨×©×™××ª ×—×©×‘×•× ×•×ª
- âœ… ×™×•×–×¨ ×™×›×•×œ ×œ×—×‘×¨ ×—×©×‘×•×Ÿ

---

### ×™×•× 7: Database Schema - Part 2

**××˜×¨×”:** ×œ×™×¦×•×¨ ××ª ×©××¨ ×”×˜×‘×œ××•×ª (profiles, raw_events, baseline, detections).

**SQL ×œ×”×¨×¦×”:**

```sql
-- profiles
CREATE TABLE profiles (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  ad_account_id UUID NOT NULL REFERENCES ad_accounts(id) ON DELETE CASCADE,
  profile_type TEXT DEFAULT 'normal',
  thresholds JSONB DEFAULT '{
    "frequency": {
      "rapid_repeat_clicks": 3,
      "rapid_repeat_window_minutes": 2,
      "short_window_clicks": 5,
      "short_window_minutes": 10,
      "daily_repeat_source": 8
    },
    "burst": {
      "account_spike_multiplier": 2.0,
      "campaign_spike_multiplier": 2.3,
      "micro_burst_clicks": 12,
      "micro_burst_window_minutes": 2
    },
    "temporal": {
      "off_hours_percentage": 30
    },
    "cooldown_hours": 12
  }'::jsonb,
  business_hours JSONB DEFAULT '{
    "enabled": true,
    "timezone": "Asia/Jerusalem",
    "days": {
      "sunday": {"enabled": true, "start": "08:00", "end": "18:00"},
      "monday": {"enabled": true, "start": "08:00", "end": "18:00"},
      "tuesday": {"enabled": true, "start": "08:00", "end": "18:00"},
      "wednesday": {"enabled": true, "start": "08:00", "end": "18:00"},
      "thursday": {"enabled": true, "start": "08:00", "end": "18:00"},
      "friday": {"enabled": true, "start": "08:00", "end": "14:00"},
      "saturday": {"enabled": false}
    }
  }'::jsonb,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(ad_account_id)
);

CREATE INDEX idx_profiles_account ON profiles(ad_account_id);

-- RLS
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own profiles"
ON profiles FOR SELECT
USING (ad_account_id IN (
  SELECT id FROM ad_accounts WHERE user_id = auth.uid()
));

-- raw_events
CREATE TABLE raw_events (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  ad_account_id UUID NOT NULL REFERENCES ad_accounts(id) ON DELETE CASCADE,
  click_id TEXT,
  campaign_id TEXT NOT NULL,
  campaign_name TEXT,
  ad_group_id TEXT,
  ad_group_name TEXT,
  click_timestamp TIMESTAMPTZ NOT NULL,
  device_type TEXT,
  network TEXT,
  country TEXT,
  click_cost_micros BIGINT,
  imported_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(ad_account_id, click_id, click_timestamp)
);

CREATE INDEX idx_raw_events_account ON raw_events(ad_account_id);
CREATE INDEX idx_raw_events_timestamp ON raw_events(click_timestamp);
CREATE INDEX idx_raw_events_campaign ON raw_events(campaign_id);

-- baseline_stats
CREATE TABLE baseline_stats (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  ad_account_id UUID NOT NULL REFERENCES ad_accounts(id) ON DELETE CASCADE,
  campaign_id TEXT,
  metric_type TEXT NOT NULL,
  period_days INTEGER NOT NULL,
  avg_value NUMERIC,
  std_dev NUMERIC,
  min_value NUMERIC,
  max_value NUMERIC,
  calculated_at TIMESTAMPTZ DEFAULT NOW(),
  data_points INTEGER,
  UNIQUE(ad_account_id, campaign_id, metric_type, period_days)
);

CREATE INDEX idx_baseline_account ON baseline_stats(ad_account_id);

-- detection_state
CREATE TABLE detection_state (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  ad_account_id UUID NOT NULL REFERENCES ad_accounts(id) ON DELETE CASCADE,
  learning_mode BOOLEAN DEFAULT TRUE,
  learning_started_at TIMESTAMPTZ DEFAULT NOW(),
  baseline_ready_at TIMESTAMPTZ,
  days_with_data INTEGER DEFAULT 0,
  total_events_collected INTEGER DEFAULT 0,
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(ad_account_id)
);

-- detections
CREATE TABLE detections (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  ad_account_id UUID NOT NULL REFERENCES ad_accounts(id) ON DELETE CASCADE,
  campaign_id TEXT,
  rule_id TEXT NOT NULL,
  rule_name TEXT NOT NULL,
  severity TEXT NOT NULL,
  time_window_start TIMESTAMPTZ NOT NULL,
  time_window_end TIMESTAMPTZ NOT NULL,
  evidence JSONB,
  action_decided TEXT,
  action_status TEXT DEFAULT 'pending',
  action_executed_at TIMESTAMPTZ,
  action_response TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(ad_account_id, rule_id, time_window_start, campaign_id)
);

CREATE INDEX idx_detections_account ON detections(ad_account_id);
CREATE INDEX idx_detections_created ON detections(created_at);

-- cooldown_tracker
CREATE TABLE cooldown_tracker (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  ad_account_id UUID NOT NULL REFERENCES ad_accounts(id) ON DELETE CASCADE,
  entity_type TEXT NOT NULL,
  entity_id TEXT NOT NULL,
  rule_id TEXT NOT NULL,
  cooldown_until TIMESTAMPTZ NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(ad_account_id, entity_type, entity_id, rule_id)
);

CREATE INDEX idx_cooldown_active ON cooldown_tracker(ad_account_id, cooldown_until)
WHERE cooldown_until > NOW();

-- monthly_reports
CREATE TABLE monthly_reports (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  ad_account_id UUID NOT NULL REFERENCES ad_accounts(id) ON DELETE CASCADE,
  report_month INTEGER NOT NULL,
  report_year INTEGER NOT NULL,
  total_clicks_checked INTEGER DEFAULT 0,
  suspicious_clicks INTEGER DEFAULT 0,
  actions_taken INTEGER DEFAULT 0,
  quiet_score INTEGER,
  quiet_status TEXT,
  system_active_days INTEGER,
  scans_performed INTEGER,
  report_data JSONB,
  sent_at TIMESTAMPTZ,
  sent_via TEXT,
  send_status TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(ad_account_id, report_year, report_month)
);

CREATE INDEX idx_reports_account ON monthly_reports(ad_account_id);
```

**Definition of Done:**
- âœ… ×›×œ ×”×˜×‘×œ××•×ª × ×•×¦×¨×•
- âœ… Indexes ×‘×¡×“×¨
- âœ… RLS policies ×¤×¢×™×œ×•×ª

---

### ×™×•× 8-9: REST - ×ª×›× ×•×Ÿ ×•×‘×“×™×§×•×ª

**××˜×¨×”:** ×œ×”×‘×™×Ÿ ××ª ××” ×©×‘× ×™× ×• ×•×œ×•×•×“× ×©×”×›×œ ×¢×•×‘×“.

**××©×™××•×ª ×™×•× 8:**

1. **×ª×¢×“ ××ª ×›×œ ×”API**
   - ×¨×©×•× ××ª ×›×œ ×”-endpoints ×©×™×©
   - ×‘×“×•×§ ×¢× Postman/Thunder Client

2. **×‘×“×•×§ Auth Flow**
   - × ×¡×” signup â†’ login â†’ logout
   - ×•×“× ×©-sessions ×¢×•×‘×“×™×

3. **×‘×“×•×§ Google Ads OAuth**
   - ×¢×‘×•×¨ ××ª ×›×œ ×”×ª×”×œ×™×š
   - ×•×“× ×©×”×˜×•×§× ×™× × ×©××¨×™×

**××©×™××•×ª ×™×•× 9:**

1. **×›×ª×•×‘ README.md**
   - ××™×š ×œ×”×¨×™×¥ ××ª ×”×¤×¨×•×™×§×˜
   - ××©×ª× ×™ ×¡×‘×™×‘×” × ×“×¨×©×™×
   - API endpoints

2. **×§×¦×ª Cleanup**
   - ×”×¡×¨ console.log ××™×•×ª×¨×™×
   - ×ª×§×Ÿ ×”×•×“×¢×•×ª ×©×’×™××”

**Definition of Done:**
- âœ… ×›×œ ××” ×©×‘× ×™× ×• ×¢×•×‘×“
- âœ… README ××¢×•×“×›×Ÿ
- âœ… Git commit × ×§×™

---

### ×™×•× 10: Dashboard - Basic UI

**××˜×¨×”:** ×œ×”×ª×—×™×œ ×œ×‘× ×•×ª ××ª ×”×“×©×‘×•×¨×“.

**Cursor Prompt:**
```
Create frontend/src/pages/Dashboard.jsx:

Show:
- Navbar with user email and logout button
- Sidebar with navigation: Overview, Detections, Settings
- Main content area with "Welcome to MagenAd"
- List of connected ad accounts with status (active/expired)
- "Connect Account" button

Use React Router for navigation.
Use Tailwind for styling - clean, modern, blue/white theme.

Also create:
- frontend/src/components/Navbar.jsx
- frontend/src/components/Sidebar.jsx
- frontend/src/components/AccountCard.jsx (shows account info)
```

**Definition of Done:**
- âœ… Dashboard × ×¨××” ×˜×•×‘
- âœ… Navigation ×¢×•×‘×“
- âœ… ×¨×•××™× ×¨×©×™××ª ×—×©×‘×•× ×•×ª

---

### ×™×•× 11-12: API Routes - Dashboard Data

**××˜×¨×”:** API endpoints ×œ×“×©×‘×•×¨×“.

**Cursor Prompt:**
```
Create backend/routes/dashboard.js:

GET /overview/:ad_account_id:
- Requires auth
- Check user owns this account
- Return:
  {
    connection_status: "active" | "expired" | "error",
    learning_mode: boolean,
    current_month: {
      clicks_checked: number,
      suspicious: number,
      actions: number,
      quiet_score: number,
      quiet_status: "quiet" | "normal" | "alert"
    },
    last_sync: timestamp,
    system_health: "ok" | "warning" | "error"
  }

GET /detections/:ad_account_id:
- Query params: from, to, severity, campaign_id
- Return paginated list of detections
- Include evidence and action details

Mount in server.js at /api/dashboard
```

**Frontend:**
```
Update frontend/src/pages/Dashboard.jsx:

When user selects an account:
- Fetch /api/dashboard/overview/:id
- Display:
  - Connection status badge
  - Learning mode notice (if true)
  - Stats: clicks checked, suspicious, actions
  - Quiet Index with color indicator
  - Last sync time
```

**Definition of Done:**
- âœ… Dashboard ××¦×™×’ × ×ª×•× ×™× ×××™×ª×™×™× (×’× ×× ×¨×™×§×™×)
- âœ… ××™×Ÿ errors
- âœ… Loading states ×¢×•×‘×“×™×

---

### ×™×•× 13-14: ×—×•×–×¨×™× ×¢×œ ×”×©×‘×•×¢×™×™×

**××˜×¨×”:** ×œ×•×•×“× ×©×”×›×œ ×™×¦×™×‘ ×œ×¤× ×™ ×©×××©×™×›×™×.

**Checklist:**
- âœ… Auth ×¢×•×‘×“ ××¢×•×œ×”
- âœ… Google Ads OAuth ×¢×•×‘×“
- âœ… Database Schema ××œ×
- âœ… Dashboard ×‘×¡×™×¡×™ ×¢×•×‘×“
- âœ… API ××ª×•×¢×“
- âœ… Git ××¢×•×“×›×Ÿ

**×× ×™×© ×‘×¢×™×•×ª - ×ª×§×Ÿ ××•×ª×Ÿ ×¢×›×©×™×•!**

---

## 4. ×©×‘×•×¢ 3-4: Data & Detection

### ×™×•× 15: Google Ads API - First Call

**××˜×¨×”:** ×œ×©×œ×•×£ ×§×œ×™×§×™× ×××™×ª×™×™× ×Google Ads.

**Cursor Prompt:**
```
Update backend/services/googleAds.js:

Add function fetchClicks(account, options):
- options: { from: Date, to: Date }
- Uses Google Ads API library
- Query:
  SELECT
    click_view.gclid,
    segments.date,
    segments.hour,
    segments.device,
    segments.click_type,
    campaign.id,
    campaign.name,
    ad_group.id,
    ad_group.name,
    metrics.clicks,
    metrics.cost_micros
  FROM click_view
  WHERE segments.date >= 'YYYY-MM-DD'
    AND segments.date <= 'YYYY-MM-DD'

- Transform to our format:
  {
    ad_account_id,
    click_id: gclid,
    campaign_id,
    campaign_name,
    ad_group_id,
    ad_group_name,
    click_timestamp: Date,
    device_type,
    network,
    country: 'IL', // derive from geo if available
    click_cost_micros
  }

- Return array of clicks
```

**Test:**
```
Create backend/scripts/test-fetch-clicks.js:
- Load one account from DB
- Call fetchClicks for last 7 days
- Console.log the results
- Run with: node scripts/test-fetch-clicks.js
```

**Definition of Done:**
- âœ… `fetchClicks()` ××—×–×™×¨ × ×ª×•× ×™× ×××™×ª×™×™×
- âœ… ×”×¤×•×¨××˜ ×ª×•×× ×œ-raw_events
- âœ… ××™×Ÿ crashes

---

### ×™×•× 16: Data Ingestion Job - Part 1

**××˜×¨×”:** Job ×©×¨×¥ ××•×˜×•××˜×™×ª ×•×©×•×œ×£ clicks.

**Cursor Prompt:**
```
Create backend/jobs/ingest-clicks.js:

- Use node-cron to schedule: '0 */6 * * *' (every 6 hours)
- On trigger:
  1. Fetch all active ad_accounts
  2. For each account:
     a. Check if token is expired
     b. Refresh if needed
     c. Call fetchClicks(account, { from: 6 hours ago, to: now })
     d. Upsert to raw_events (use UNIQUE constraint for idempotency)
     e. Update ad_accounts.last_sync_at and last_sync_status
  3. Log summary: "Synced X accounts, Y clicks"

Handle errors:
- If account fails, log error and continue to next
- Save error message to ad_accounts.last_error_message

Export the cron job so server.js can import and start it.
```

**Update server.js:**
```javascript
// Add at end of server.js
require('./jobs/ingest-clicks');
console.log('âœ“ Ingestion job scheduled');
```

**Definition of Done:**
- âœ… Job ×¨×¥ ×›×œ 6 ×©×¢×•×ª
- âœ… Clicks × ×©××¨×™× ×‘-raw_events
- âœ… Idempotency ×¢×•×‘×“ (××™×Ÿ duplicates)
- âœ… Errors ××ª×•×¢×“×™×

---

### ×™×•× 17: Data Ingestion Job - Testing

**××˜×¨×”:** ×œ×•×•×“× ×©×”Job ×¢×•×‘×“ ××¢×•×œ×”.

**××©×™××•×ª:**

1. **×”×¨×¥ ×™×“× ×™×ª:**
```bash
node backend/jobs/ingest-clicks.js
```

2. **×‘×“×•×§ ×‘-Supabase:**
   - Table Editor â†’ raw_events
   - ×•×“× ×©×™×© clicks

3. **×‘×“×•×§ Idempotency:**
   - ×”×¨×¥ ×¤×¢××™×™×
   - ×•×“× ×©××™×Ÿ duplicates

4. **×‘×“×•×§ Error Handling:**
   - × ×ª×§ ×—×©×‘×•×Ÿ
   - ×•×“× ×©Job ×œ× ×§×•×¨×¡

**Definition of Done:**
- âœ… Job ×¢×•×‘×“ ×œ×œ× ×©×’×™××•×ª
- âœ… Data × ×›×•×Ÿ
- âœ… ××•×›×Ÿ ×œ×™×™×¦×•×¨

---

### ×™×•× 18: Baseline Calculation Job

**××˜×¨×”:** ×œ×—×©×‘ baseline stats.

**Cursor Prompt:**
```
Create backend/jobs/calculate-baseline.js:

Schedule: '0 2 * * *' (2 AM daily)

Function calculateBaseline(accountId, periodDays = 14):

1. Query raw_events for last {periodDays} days
2. Calculate:
   - clicks_per_day: { avg, std_dev, min, max }
   - device_distribution: { mobile: %, desktop: %, tablet: % }
   - network_distribution: { search: %, display: % }
3. Upsert to baseline_stats

Function updateLearningMode(accountId):
- Check detection_state
- Count days_with_data (distinct dates in raw_events)
- Count total_events_collected
- If days >= 7 AND events >= 100:
  - Set learning_mode = false
  - Set baseline_ready_at = now

Export cron job.
```

**Definition of Done:**
- âœ… Baseline ××—×•×©×‘ ×›×œ ×œ×™×œ×”
- âœ… Learning Mode ××ª×¢×“×›×Ÿ ××•×˜×•××˜×™×ª
- âœ… × ×™×ª×Ÿ ×œ×¨××•×ª ×‘-baseline_stats

---

### ×™×•× 19: Source Key Utils

**××˜×¨×”:** ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×œ-Source Key.

**Cursor Prompt:**
```
Create backend/utils/sourceKey.js:

Export functions:

generateSourceKey(click):
- Returns: "DEVICE::NETWORK::COUNTRY::CAMPAIGN_ID"
- Handle missing fields with "UNKNOWN"

parseSourceKey(key):
- Returns: { device_type, network, country, campaign_id }

groupBySourceKey(clicks):
- Returns: { sourceKey: [click, click, ...] }

filterByMinClicks(grouped, minClicks):
- Returns only sources with >= minClicks

All functions should have JSDoc comments.
```

**Test:**
```javascript
// backend/tests/sourceKey.test.js
const { generateSourceKey, groupBySourceKey } = require('../utils/sourceKey');

const testClicks = [
  { device_type: 'MOBILE', network: 'SEARCH', country: 'IL', campaign_id: '123', click_timestamp: '2025-01-01T10:00:00Z' },
  { device_type: 'MOBILE', network: 'SEARCH', country: 'IL', campaign_id: '123', click_timestamp: '2025-01-01T10:01:00Z' },
  { device_type: 'DESKTOP', network: 'SEARCH', country: 'IL', campaign_id: '123', click_timestamp: '2025-01-01T10:02:00Z' },
];

const grouped = groupBySourceKey(testClicks);
console.log(grouped);
// Should group first 2 together, third separate
```

**Definition of Done:**
- âœ… ×›×œ ×”×¤×•× ×§×¦×™×•×ª ×¢×•×‘×“×•×ª
- âœ… Test ×¢×•×‘×¨
- âœ… ××ª×•×¢×“

---

### ×™×•× 20: Detection Rule - A1 (Rapid Repeat)

**××˜×¨×”:** ×œ×‘× ×•×ª ××ª ×”×—×•×§ ×”×¨××©×•×Ÿ.

**Cursor Prompt:**
```
Create backend/rules/DetectionRule.js (base class):

class DetectionRule {
  constructor(id, name, severity) {
    this.id = id;
    this.name = name;
    this.severity = severity;
    this.supabase = require('../services/supabase');
  }
  
  async detect(account, timeWindow) {
    throw new Error('Must implement detect()');
  }
}

module.exports = DetectionRule;

---

Create backend/rules/A1-RapidRepeat.js:

Extend DetectionRule.
Implement detect(account):
- Fetch clicks from last 60 minutes
- Group by Source Key
- For each source, sliding window:
  - Check if >= threshold clicks in window_minutes
  - If yes, check cooldown
  - If not in cooldown, create detection
  - Set cooldown
- Return array of detections

Use thresholds from account.profiles.thresholds.frequency
```

**Definition of Done:**
- âœ… ×—×•×§ A1 ×¢×•×‘×“
- âœ… ××–×”×” ×—×¨×™×’×•×ª ×××™×ª×™×•×ª
- âœ… Cooldown ×¢×•×‘×“

---

### ×™×•× 21-22: More Detection Rules

**××˜×¨×”:** ×œ×‘× ×•×ª ×¢×•×“ 3-4 ×—×•×§×™×.

**××©×™××•×ª ×™×•× 21:**
- A2 (Short Window Repeat)
- A3 (Daily Repeat Source)

**××©×™××•×ª ×™×•× 22:**
- B1 (Account Spike)
- B2 (Campaign Spike)

**Cursor Prompt (×ª×‘× ×™×ª):**
```
Create backend/rules/{RULE_ID}-{Name}.js:

Extend DetectionRule.
Rule ID: {RULE_ID}
Rule Name: {Name}
Severity: {Severity}

Logic:
{describe the logic}

Use thresholds from account.profiles.thresholds.{category}

Return detections in format:
{
  rule_id,
  rule_name,
  severity,
  time_window_start,
  time_window_end,
  campaign_id,
  evidence: { ... },
  action_decided: 'report' | 'mark'
}
```

**Definition of Done:**
- âœ… 5 ×—×•×§×™× ×¢×•×‘×“×™×
- âœ… ×›×œ ×—×•×§ × ×‘×“×§ ×‘× ×¤×¨×“

---

### ×™×•× 23: Detection Engine Runner

**××˜×¨×”:** Job ×©××¨×™×¥ ××ª ×›×œ ×”×—×•×§×™×.

**Cursor Prompt:**
```
Create backend/jobs/run-detection.js:

Schedule: '0 * * * *' (hourly)

Import all rules:
- A1_RapidRepeat
- A2_ShortWindow
- A3_DailyRepeat
- B1_AccountSpike
- B2_CampaignSpike

const RULES = [new A1_RapidRepeat(), ...];

On trigger:
1. Fetch active accounts with profiles and detection_state
2. Filter out accounts in learning_mode
3. For each account:
   - For each rule:
     - Try: detections = await rule.detect(account)
     - Catch: log error, continue
     - If detections.length > 0:
       - Save to detections table
       - Log: "Rule {id} found {count} detections"

Function saveDetections(accountId, detections):
- Insert into detections table
- Set action_status = 'pending'

Export cron job.
```

**Definition of Done:**
- âœ… Detection Engine ×¨×¥ ×›×œ ×©×¢×”
- âœ… ×›×œ ×”×—×•×§×™× ××•×¤×¢×œ×™×
- âœ… Detections × ×©××¨×™× ×‘-DB

---

### ×™×•× 24-25: Testing Detection Engine

**××˜×¨×”:** ×œ×•×•×“× ×©×”Detection Engine ×¢×•×‘×“ ××¢×•×œ×”.

**××©×™××•×ª ×™×•× 24:**

1. **×¦×•×¨ Test Data**
```sql
-- Insert fake clicks for testing
INSERT INTO raw_events (ad_account_id, campaign_id, click_id, click_timestamp, device_type, network, country)
VALUES
  ('account-uuid', '123', 'click1', NOW() - INTERVAL '1 minute', 'MOBILE', 'SEARCH', 'IL'),
  ('account-uuid', '123', 'click2', NOW() - INTERVAL '30 seconds', 'MOBILE', 'SEARCH', 'IL'),
  ('account-uuid', '123', 'click3', NOW(), 'MOBILE', 'SEARCH', 'IL');
```

2. **×”×¨×¥ Detection**
```bash
node backend/jobs/run-detection.js
```

3. **×‘×“×•×§ detections**
```sql
SELECT * FROM detections WHERE ad_account_id = 'account-uuid';
```

**××©×™××•×ª ×™×•× 25:**

1. **×‘×“×•×§ Cooldown**
   - ×”×¨×¥ ×©×•×‘
   - ×•×“× ×©×œ× ×™×•×¦×¨ duplicate detection

2. **×‘×“×•×§ Baseline Dependency**
   - ×—×©×‘×•×Ÿ ×¢×/×‘×œ×™ baseline
   - ×•×“× ×©×—×•×§×™ Burst ×¢×•×‘×“×™× × ×›×•×Ÿ

3. **×‘×“×•×§ Learning Mode**
   - ×—×©×‘×•×Ÿ ×‘-Learning Mode
   - ×•×“× ×©×œ× ××¨×™×¥ detection

**Definition of Done:**
- âœ… Detection Engine ×™×¦×™×‘
- âœ… ××™×Ÿ false positives ××˜×•×¨×¤×™×
- âœ… ××•×›×Ÿ ×œ×™×™×¦×•×¨

---

### ×™×•× 26-28: ×©××¨ ×”×—×•×§×™×

**××˜×¨×”:** ×œ×¡×™×™× ××ª ×›×œ 12 ×”×—×•×§×™×.

**×™×•× 26:**
- B3 (Micro-Burst)
- C1 (Off-Hours)

**×™×•× 27:**
- C2 (Night Burst)
- D1 (Network Shift)

**×™×•× 28:**
- E1 (Multi-Rule Confirmation)
- E2 (Suspicious Score)
- F1 (Rate Limit)

**Cursor Prompt ×œ×›×œ ×—×•×§:**
```
Create backend/rules/{ID}-{Name}.js following the pattern from A1.

[Include specific logic from the Detection Rules document]

Test with realistic data.
```

**Definition of Done:**
- âœ… ×›×œ 12 ×”×—×•×§×™× ×¢×•×‘×“×™×
- âœ… × ×‘×“×§×• ×¢× × ×ª×•× ×™× ×××™×ª×™×™×
- âœ… Cooldowns + Rate Limiting ×¢×•×‘×“×™×

---

## 5. ×©×‘×•×¢ 5-6: Dashboard & Reports

### ×™×•× 29: Quiet Index Calculator

**××˜×¨×”:** ×œ×—×©×‘ ××ª ××“×“ ×”×©×§×˜.

**Cursor Prompt:**
```
Create backend/utils/quietIndex.js:

Export functions:

calculateQuietIndex(detections):
- Start with score = 100
- For each detection:
  - If severity === 'high': score -= 10
  - If severity === 'medium': score -= 5
  - If severity === 'low': score -= 2
- Return Math.max(0, Math.min(100, score))

getQuietStatus(score):
- If score >= 80: return 'quiet'
- If score >= 50: return 'normal'
- Return 'alert'

getQuietEmoji(status):
- quiet: 'ğŸŸ¢'
- normal: 'ğŸŸ¡'
- alert: 'ğŸ”´'

getQuietMessage(score, status):
- Return Hebrew message based on status
```

**Test:**
```javascript
const detections = [
  { severity: 'high' },
  { severity: 'medium' },
  { severity: 'medium' }
];

const score = calculateQuietIndex(detections); // 100 - 10 - 5 - 5 = 80
const status = getQuietStatus(score); // 'quiet'
console.log(`${getQuietEmoji(status)} ${score} - ${getQuietMessage(score, status)}`);
```

**Definition of Done:**
- âœ… Quiet Index ×¢×•×‘×“
- âœ… ×”×•×“×¢×•×ª ×‘×¢×‘×¨×™×ª
- âœ… ××ª×•×¢×“

---

### ×™×•× 30: Dashboard - Overview Page

**××˜×¨×”:** ×“×£ Overview ××œ× ×¢× × ×ª×•× ×™× ×××™×ª×™×™×.

**Cursor Prompt:**
```
Update frontend/src/pages/Dashboard.jsx:

Fetch /api/dashboard/overview/:accountId

Display:

1. Connection Status Badge:
   - Green: "××—×•×‘×¨ ×•×¤×¢×™×œ"
   - Yellow: "×˜×•×§×Ÿ ×¤×’ ×ª×•×§×£"
   - Red: "×©×’×™××” ×‘×—×™×‘×•×¨"

2. Learning Mode Notice (if true):
   - Blue info box: "×”××¢×¨×›×ª ×œ×•××“×ª ××ª ×”×“×¤×•×¡×™× ×©×œ×š - ×¢×•×“ X ×™××™×"

3. Stats Cards (3 cards in a row):
   Card 1: × ×‘×“×§×•
   - Big number: {clicks_checked}
   - Label: "×§×œ×™×§×™× × ×‘×“×§×• ×”×—×•×“×©"
   
   Card 2: ×—×©×•×“×™×
   - Big number: {suspicious}
   - Label: "×§×œ×™×§×™× ×—×©×•×“×™×"
   
   Card 3: ×¤×¢×•×œ×•×ª
   - Big number: {actions}
   - Label: "×¤×¢×•×œ×•×ª ×©×‘×•×¦×¢×•"

4. Quiet Index (large, centered):
   - Circle with color (green/yellow/red)
   - Score: {quiet_score}/100
   - Status emoji + text

5. Last Sync:
   - Small text: "×¢×“×›×•×Ÿ ××—×¨×•×Ÿ: {last_sync}"

Use Tailwind, make it beautiful and clean.
```

**Definition of Done:**
- âœ… Overview × ×¨××” ××¢×•×œ×”
- âœ… × ×ª×•× ×™× ×××™×ª×™×™×
- âœ… Responsive (mobile ×ª×•××š)

---

### ×™×•× 31: Dashboard - Detections Page

**××˜×¨×”:** ×¢××•×“ ×©××¨××” ××ª ×›×œ ×”Detections.

**Cursor Prompt:**
```
Create frontend/src/pages/Detections.jsx:

Fetch /api/dashboard/detections/:accountId with filters:
- from/to dates (date picker)
- severity (dropdown: all, high, medium, low)
- campaign_id (dropdown from campaigns)

Display as table:
| ×ª××¨×™×š | ×§××¤×™×™×Ÿ | ×—×•×§ | ×—×•××¨×” | ×¤×¢×•×œ×” | ×¡×˜×˜×•×¡ |
|-------|--------|-----|--------|-------|--------|
| ...   | ...    | ... | ...    | ...   | ...    |

Each row expandable to show evidence details.

Pagination: 20 per page.

Use Tailwind table styling.
```

**Definition of Done:**
- âœ… ×˜×‘×œ×” ×¢×•×‘×“×ª
- âœ… ×¤×™×œ×˜×¨×™× ×¢×•×‘×“×™×
- âœ… Pagination ×¢×•×‘×“

---

### ×™×•× 32: Dashboard - Settings Page

**××˜×¨×”:** ×“×£ ×”×’×“×¨×•×ª - ×©×™× ×•×™ ×¤×¨×•×¤×™×œ ×•thresholds.

**Cursor Prompt:**
```
Create frontend/src/pages/Settings.jsx:

Fetch /api/profiles/:accountId

Display:

1. Profile Selector:
   - Radio buttons: Easy, Normal (××•××œ×¥), Aggressive
   - On change: PUT /api/profiles/:accountId with { profile_type }

2. Custom Thresholds (only if profile === 'custom'):
   - Show editable inputs for key thresholds
   - Save button

3. Business Hours:
   - Toggle for each day
   - Start/End time pickers
   - Save button

4. Reset Button:
   - "×—×–×•×¨ ×œ×”×’×“×¨×•×ª ×”××•××œ×¦×•×ª"
   - POST /api/profiles/:accountId/reset

Use form validation.
Show success/error messages.
```

**Backend:**
```
Create/update backend/routes/profiles.js:

GET /profiles/:ad_account_id:
- Return profile with thresholds

PUT /profiles/:ad_account_id:
- Update profile_type or thresholds
- Log to audit_log

POST /profiles/:ad_account_id/reset:
- Reset to default 'normal' profile
```

**Definition of Done:**
- âœ… ×”×’×“×¨×•×ª ×¢×•×‘×“×•×ª
- âœ… ×©×™× ×•×™×™× × ×©××¨×™×
- âœ… Reset ×¢×•×‘×“

---

### ×™×•× 33: Monthly Report Generator

**××˜×¨×”:** Job ×©×™×•×¦×¨ ×“×•×— ×—×•×“×©×™.

**Cursor Prompt:**
```
Create backend/jobs/generate-monthly-report.js:

Schedule: '5 0 1 * *' (1st of month at 00:05)

Function generateReport(accountId, year, month):

1. Get date range (last month)
2. Count total clicks from raw_events
3. Count detections (suspicious clicks)
4. Count actions (where action_status = 'success')
5. Calculate Quiet Index from detections
6. Calculate system stats:
   - days_with_data
   - scans_performed (estimate: days * 4)

7. Get top campaigns with most detections

8. Insert to monthly_reports:
   {
     ad_account_id,
     report_year,
     report_month,
     total_clicks_checked,
     suspicious_clicks,
     actions_taken,
     quiet_score,
     quiet_status,
     system_active_days,
     scans_performed,
     report_data: { top_campaigns, ... },
     send_status: 'pending'
   }

9. Return report

Export cron job.
```

**Definition of Done:**
- âœ… Report × ×•×¦×¨ ××•×˜×•××˜×™×ª
- âœ… × ×ª×•× ×™× × ×›×•× ×™×
- âœ… × ×©××¨ ×‘-DB

---

### ×™×•× 34: WhatsApp Business API Setup

**××˜×¨×”:** ×œ×”×’×“×™×¨ WhatsApp Business.

**××©×™××•×ª:**

1. **×¦×•×¨ Facebook Business Account**
   - https://business.facebook.com

2. **×¦×•×¨ WhatsApp Business Account**
   - ×“×¨×š Meta Business Suite

3. **×§×‘×œ Phone Number ID + Access Token**
   - WhatsApp Manager â†’ Settings

4. **×”×•×¡×£ ×œ-.env:**
```
WHATSAPP_PHONE_NUMBER_ID=your_phone_number_id
WHATSAPP_ACCESS_TOKEN=your_access_token
```

5. **×¦×•×¨ Template (××•×¤×¦×™×•× ×œ×™ ×œ-V1)**
   - WhatsApp Manager â†’ Message Templates
   - ×©×: `monthly_report`
   - ×§×˜×’×•×¨×™×”: `UTILITY`

**Definition of Done:**
- âœ… WhatsApp Business ××•×’×“×¨
- âœ… ×™×© Phone Number ID + Token
- âœ… ××¤×©×¨ ×œ×©×œ×•×— ×”×•×“×¢×” (test)

---

### ×™×•× 35: WhatsApp Integration

**××˜×¨×”:** ×œ×©×œ×•×— ×“×•×— ×‘WhatsApp.

**Cursor Prompt:**
```
Create backend/services/whatsapp.js:

const axios = require('axios');

class WhatsAppService {
  constructor() {
    this.phoneNumberId = process.env.WHATSAPP_PHONE_NUMBER_ID;
    this.accessToken = process.env.WHATSAPP_ACCESS_TOKEN;
    this.apiUrl = `https://graph.facebook.com/v18.0/${this.phoneNumberId}/messages`;
  }
  
  async sendMonthlyReport(recipient, report) {
    const message = this.formatMessage(report);
    
    const response = await axios.post(
      this.apiUrl,
      {
        messaging_product: 'whatsapp',
        to: recipient, // +972501234567 format
        type: 'text',
        text: { body: message }
      },
      {
        headers: {
          'Authorization': `Bearer ${this.accessToken}`,
          'Content-Type': 'application/json'
        }
      }
    );
    
    return response.data;
  }
  
  formatMessage(report) {
    const emoji = report.quiet_status === 'quiet' ? 'ğŸŸ¢'
                : report.quiet_status === 'normal' ? 'ğŸŸ¡'
                : 'ğŸ”´';
    
    return `
*×“×•×— ×—×•×“×©×™ - MagenAd* ${emoji}

ğŸ“Š *×¡×™×›×•×:*
â€¢ × ×‘×“×§×•: ${report.total_clicks_checked.toLocaleString()} ×§×œ×™×§×™×
â€¢ ×—×©×•×“×™×: ${report.suspicious_clicks}
â€¢ ×¤×¢×•×œ×•×ª: ${report.actions_taken}

${emoji} *××“×“ ×©×§×˜:* ${report.quiet_score}/100

ğŸ” ×”××¢×¨×›×ª ×¤×¢×™×œ×” ${report.system_active_days} ×™××™×
âš™ï¸ ×‘×•×¦×¢×• ${report.scans_performed} ×¡×¨×™×§×•×ª

ğŸ”— ×œ×¤×™×¨×•×˜ ××œ×: https://app.magenad.com
    `.trim();
  }
}

module.exports = new WhatsAppService();
```

**Update generate-monthly-report.js:**
```javascript
// After creating report:
const whatsapp = require('../services/whatsapp');
const { data: user } = await supabase
  .from('users')
  .select('whatsapp_number')
  .eq('id', account.user_id)
  .single();

if (user.whatsapp_number) {
  await whatsapp.sendMonthlyReport(user.whatsapp_number, report);
  
  await supabase
    .from('monthly_reports')
    .update({
      sent_at: new Date(),
      sent_via: 'whatsapp',
      send_status: 'sent'
    })
    .eq('id', reportId);
}
```

**Definition of Done:**
- âœ… ×”×•×“×¢×ª WhatsApp × ×©×œ×—×ª
- âœ… ×”×¤×•×¨××˜ ×™×¤×” ×•×§×¨×™×
- âœ… Status ××ª×¢×“×›×Ÿ ×‘-DB

---

### ×™×•× 36-37: Reports Page

**××˜×¨×”:** ×¢××•×“ ×“×•×—×•×ª ×—×•×“×©×™×™×.

**Cursor Prompt:**
```
Create frontend/src/pages/Reports.jsx:

Fetch /api/reports/:accountId (all monthly reports)

Display:
- List of months (cards)
- Each card shows:
  - Month/Year
  - Quiet Index (big, with color)
  - Key stats
  - "View Full Report" button

On click:
- Modal/page with full report details
- Top campaigns
- Severity breakdown
- Download PDF button (optional V2)
```

**Backend:**
```
Create backend/routes/reports.js:

GET /reports/:ad_account_id:
- Return all monthly_reports for this account
- Order by year/month DESC

GET /reports/:ad_account_id/:year/:month:
- Return specific report with full details
```

**Definition of Done:**
- âœ… ×“×•×—×•×ª ××•×¦×’×™×
- âœ… × ×™×ª×Ÿ ×œ×¨××•×ª ×“×•×— ××œ×
- âœ… UI × ×§×™

---

### ×™×•× 38-42: Polish & UX

**××˜×¨×”:** ×œ×©×¤×¨ ××ª ×”-UI/UX.

**××©×™××•×ª:**

**×™×•× 38:**
- Loading skeletons
- Error boundaries
- Empty states ("××™×Ÿ × ×ª×•× ×™× ×¢×“×™×™×Ÿ")

**×™×•× 39:**
- Responsive mobile
- Touch-friendly buttons
- Mobile menu

**×™×•× 40:**
- Hebrew RTL support
- ×ª×¨×’×•× ×›×œ ×”×˜×§×¡×˜×™× ×œ×¢×‘×¨×™×ª
- ×ª×™×§×•×Ÿ alignment

**×™×•× 41:**
- Animations (subtle)
- Transitions ×‘×™×Ÿ ×¢××•×“×™×
- Micro-interactions

**×™×•× 42:**
- Accessibility
- Keyboard navigation
- Screen reader support (×‘×¡×™×¡×™)

**Definition of Done:**
- âœ… ×”××¢×¨×›×ª × ×¨××™×ª ××§×¦×•×¢×™×ª
- âœ… ×—×•×•×™×™×ª ××©×ª××© ××¢×•×œ×”
- âœ… ××•×›×Ÿ ×œ×”×¦×’×” ×œ×œ×§×•×—×•×ª

---

## 6. ×©×‘×•×¢ 7-8: Testing & Polish

### ×™×•× 43-45: Real Data Testing

**××˜×¨×”:** ×œ×‘×“×•×§ ×¢× × ×ª×•× ×™× ×××™×ª×™×™×.

**××©×™××•×ª ×™×•× 43:**

1. **×—×‘×¨ ××ª ×”×—×©×‘×•×Ÿ ×©×œ×š (××™× ×¡×˜×œ×¦×™×”)**
2. **×”×¨×¥ ××ª ×›×œ ×”Jobs ×™×“× ×™×ª:**
```bash
node backend/jobs/ingest-clicks.js
node backend/jobs/calculate-baseline.js
node backend/jobs/run-detection.js
```
3. **×‘×“×•×§ ×©×”×›×œ ×¢×•×‘×“**

**××©×™××•×ª ×™×•× 44:**

1. **×—×›×” 24 ×©×¢×•×ª** (×ª×Ÿ ×œ××¢×¨×›×ª ×œ×¦×‘×•×¨ × ×ª×•× ×™×)
2. **×‘×“×•×§ Dashboard:**
   - ×”×× ×”× ×ª×•× ×™× × ×›×•× ×™×?
   - ×”×× Baseline ××—×•×©×‘?
   - ×”×× ×™×© detections?

**××©×™××•×ª ×™×•× 45:**

1. **×‘×“×•×§ Edge Cases:**
   - ×—×©×‘×•×Ÿ ×‘×œ×™ ×§×œ×™×§×™×
   - ×—×©×‘×•×Ÿ ×¢× ×”×¨×‘×” ×§×œ×™×§×™×
   - ×—×©×‘×•×Ÿ ×¢× ×˜×•×§×Ÿ ×©×¤×’

2. **×ª×§×Ÿ ×‘××’×™× ×©××¦××ª**

**Definition of Done:**
- âœ… ×”××¢×¨×›×ª ×¢×•×‘×“×ª ×¢× × ×ª×•× ×™× ×××™×ª×™×™×
- âœ… ××™×Ÿ ×‘××’×™× ×§×¨×™×˜×™×™×
- âœ… Baseline + Detection + Reports - ×”×›×œ ×¢×•×‘×“

---

### ×™×•× 46-48: Bug Hunting

**××˜×¨×”:** ×œ××¦×•× ×•×œ×ª×§×Ÿ ×‘××’×™×.

**Checklist:**

**Auth & Security:**
- âœ… Session timeout ×¢×•×‘×“?
- âœ… Refresh token ×¢×•×‘×“?
- âœ… RLS ××•× ×¢ ×’×™×©×” ×œ× ××•×¨×©×™×ª?

**Data Flow:**
- âœ… Ingestion ×œ× ×™×•×¦×¨ duplicates?
- âœ… Baseline ××ª×¢×“×›×Ÿ × ×›×•×Ÿ?
- âœ… Detection ×œ× ×¨×¥ ×‘Learning Mode?

**Dashboard:**
- âœ… × ×ª×•× ×™× ×¢×“×›× ×™×™×?
- âœ… Filters ×¢×•×‘×“×™×?
- âœ… Pagination × ×›×•×Ÿ?

**Jobs:**
- âœ… Cron jobs ×¨×¦×™× ×‘×–××Ÿ?
- âœ… Error handling ×¢×•×‘×“?
- âœ… Logs ×‘×¨×•×¨×™×?

**Definition of Done:**
- âœ… ×›×œ ×”×‘××’×™× ×ª×•×§× ×•
- âœ… ×”××¢×¨×›×ª ×™×¦×™×‘×”
- âœ… ××•×›×Ÿ ×œ×œ×§×•×—×•×ª

---

### ×™×•× 49-50: Performance

**××˜×¨×”:** ×œ×•×•×“× ×©×”××¢×¨×›×ª ××”×™×¨×”.

**××©×™××•×ª:**

1. **Database Indexes:**
```sql
-- Verify all indexes exist
\d+ raw_events
\d+ detections
\d+ baseline_stats
```

2. **Query Optimization:**
   - ×”×¨×¥ EXPLAIN ANALYZE ×¢×œ queries ×›×‘×“×™×
   - ×ª×§×Ÿ queries ××™×˜×™×™×

3. **Frontend Performance:**
   - Lazy loading ×œ×¢××•×“×™×
   - Pagination ×‘×˜×‘×œ××•×ª
   - Debounce ×¢×œ filters

4. **Caching (optional):**
   - Cache baseline stats (1 hour TTL)
   - Cache dashboard overview (5 minutes TTL)

**Definition of Done:**
- âœ… Dashboard × ×˜×¢×Ÿ ×‘-< 2 ×©× ×™×•×ª
- âœ… API responses ×‘-< 500ms
- âœ… ××™×Ÿ queries ××™×˜×™×™×

---

### ×™×•× 51-53: Error Handling & Monitoring

**××˜×¨×”:** ×œ×•×•×“× ×©×”××¢×¨×›×ª ××“×•×•×—×ª ×¢×œ ×‘×¢×™×•×ª.

**××©×™××•×ª ×™×•× 51:**

1. **Logging System:**
```javascript
// backend/utils/logger.js
const winston = require('winston');

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' }),
    new winston.transports.Console({ format: winston.format.simple() })
  ]
});

module.exports = logger;
```

2. **Replace console.log with logger:**
```javascript
logger.info('Job started');
logger.error('Job failed', { error });
```

**××©×™××•×ª ×™×•× 52:**

1. **Health Check Endpoint:**
```javascript
// GET /api/health
{
  status: 'ok',
  timestamp: Date,
  services: {
    database: 'ok',
    google_ads: 'ok',
    whatsapp: 'ok'
  },
  jobs: {
    last_ingestion: timestamp,
    last_detection: timestamp,
    last_baseline: timestamp
  }
}
```

2. **Error Notifications (simple):**
```javascript
// ×× Job × ×›×©×œ > 3 ×¤×¢××™× ×‘×¨×¦×™×¤×•×ª â†’ Email ×œ×š
```

**××©×™××•×ª ×™×•× 53:**

1. **Frontend Error Boundaries**
2. **Toast Notifications ×œUser**
3. **Retry Logic ×¢×œ API calls**

**Definition of Done:**
- âœ… Logging ××§×™×£
- âœ… Health check ×¢×•×‘×“
- âœ… Errors ××˜×•×¤×œ×™× ×™×¤×”

---

### ×™×•× 54-56: Documentation

**××˜×¨×”:** ×œ×ª×¢×“ ××ª ×”××¢×¨×›×ª.

**××©×™××•×ª ×™×•× 54:**

1. **README.md ××¢×•×“×›×Ÿ:**
   - Setup instructions
   - Environment variables
   - How to run
   - Project structure

2. **API Documentation:**
   - ×›×œ ×”-endpoints
   - Request/Response examples
   - Error codes

**××©×™××•×ª ×™×•× 55:**

1. **User Guide (×‘×¢×‘×¨×™×ª):**
   - ××™×š ×œ×”×™×¨×©×
   - ××™×š ×œ×—×‘×¨ ×—×©×‘×•×Ÿ
   - ××™×š ×œ×”×‘×™×Ÿ ××ª ×”×“×©×‘×•×¨×“
   - ××™×š ×œ×©× ×•×ª ×”×’×“×¨×•×ª

**××©×™××•×ª ×™×•× 56:**

1. **Admin Guide:**
   - ××™×š ×œ×”×¨×™×¥ jobs ×™×“× ×™×ª
   - ××™×š ×œ×‘×“×•×§ logs
   - ××™×š ×œ×˜×¤×œ ×‘×‘×¢×™×•×ª × ×¤×•×¦×•×ª

**Definition of Done:**
- âœ… ×›×œ ×”×ª×™×¢×•×“ ××•×›×Ÿ
- âœ… × ×™×ª×Ÿ ×œ×”×¢×‘×™×¨ ×œ××¤×ª×— ××—×¨
- âœ… × ×™×ª×Ÿ ×œ×ª×ª ×œ×œ×§×•×—

---

## 7. ×©×‘×•×¢ 9: First Clients

### ×™×•× 57: Launch Prep

**××˜×¨×”:** ×”×›× ×” ××—×¨×•× ×” ×œ×œ×§×•×—×•×ª.

**Checklist:**

**Technical:**
- âœ… Production environment ××•×›×Ÿ (Vercel/Railway)
- âœ… Database backups ×¤×¢×™×œ×™×
- âœ… SSL certificates ×ª×§×™× ×™×
- âœ… Domain name ××•×’×“×¨ (app.magenad.com)

**Legal/Compliance:**
- âœ… Privacy Policy ×–××™×Ÿ
- âœ… Terms of Service ×–××™× ×™×
- âœ… ×”×¡×›× ×œ×§×•×— ××•×›×Ÿ

**Support:**
- âœ… Email support ××•×›×Ÿ (support@magenad.com)
- âœ… WhatsApp support ××•×›×Ÿ
- âœ… FAQ document

**Definition of Done:**
- âœ… ×”×›×œ ××•×›×Ÿ ×œ×œ×§×•×— ×¨××©×•×Ÿ

---

### ×™×•× 58: First Client Onboarding

**××˜×¨×”:** ×œ×§×•×— ×¨××©×•×Ÿ ××©×ª××© ×‘××¢×¨×›×ª.

**×ª×”×œ×™×š:**

1. **×”×–××Ÿ ×œ×§×•×— ×¤×•×˜× ×¦×™××œ×™** (×‘×Ÿ ××©×¤×—×”/×—×‘×¨/×œ×§×•×— ×××™×ª×™)

2. **Onboarding Call (30 ×“×§×•×ª):**
   - ×”×¡×‘×¨ ××” ×”××¢×¨×›×ª ×¢×•×©×”
   - ×”×¨××” Dashboard
   - ×¢×–×•×¨ ×œ×”×™×¨×©× ×•×œ×—×‘×¨ ×—×©×‘×•×Ÿ

3. **Follow-up (24 ×©×¢×•×ª ××—×¨×™):**
   - ×©××œ ×× ×”×›×œ ×¢×•×‘×“
   - ×‘×“×•×§ ×©×”× ×ª×•× ×™× ×–×•×¨××™×

4. **××™×¡×•×£ Feedback:**
   - ××” ×¢×‘×“ ×˜×•×‘?
   - ××” ××‘×œ×‘×œ?
   - ××” ×—×¡×¨?

**Definition of Done:**
- âœ… ×œ×§×•×— ×¨××©×•×Ÿ ×¤×¢×™×œ
- âœ… Feedback × ××¡×£
- âœ… ××™×Ÿ ×‘×¢×™×•×ª ×§×¨×™×˜×™×•×ª

---

### ×™×•× 59: Iteration

**××˜×¨×”:** ×ª×™×§×•× ×™× ×œ×¤×™ feedback.

**××©×™××•×ª:**

1. **×¡×§×•×¨ ××ª ×”Feedback**
2. **×ª×¢×“×£ ×ª×™×§×•× ×™×:**
   - Blocker (××•× ×¢ ×©×™××•×©) â†’ ×ª×§×Ÿ ××™×“
   - Important (××¤×¨×™×¢) â†’ ×ª×§×Ÿ ×”×™×•×
   - Nice to have â†’ ×¨×©×•× ×œ-V2

3. **×ª×§×Ÿ ××ª ××” ×©×“×—×•×£**

**Definition of Done:**
- âœ… Blockers ×ª×•×§× ×•
- âœ… ×œ×§×•×— ××¨×•×¦×”

---

### ×™×•× 60: Celebrate & Plan V2

**××˜×¨×”:** ×œ×—×’×•×’ ×•×œ×ª×›× ×Ÿ ×”×œ××”!

**××©×™××•×ª:**

1. **ğŸ‰ ×—×’×•×’!**
   - V1 ×—×™ ×•×¢×•×‘×“!
   - ×™×© ×œ×§×•×— ×¨××©×•×Ÿ!

2. **V2 Planning:**
   - ×¨×©×•× ×¨×¢×™×•× ×•×ª ×œ-V2
   - ×ª×¢×“×£ ×œ×¤×™ ×—×©×™×‘×•×ª
   - ×ª×›× ×Ÿ timeline

3. **Marketing:**
   - ×¦×•×¨ landing page
   - ×”×›×Ÿ demo video
   - ×”×ª×—×œ ×œ×©×•×•×§ ×‘×¨×¦×™× ×•×ª

**Definition of Done:**
- âœ… V1 ××•×©×œ× ×•×¤×•×¢×œ
- âœ… ×™×© ×ª×•×›× ×™×ª ×œ-V2
- âœ… ××•×›×Ÿ ×œ××›×•×¨!

---

## 8. Cursor AI Prompts

### ×˜×™×¤×™× ×œ×¢×‘×•×“×” ×¢× Cursor

**1. ×ª××™×“ ×ª×ª×—×™×œ ×¢× Context:**
```
I'm building a click fraud detection system called MagenAd.
Stack: Node.js + Express + React + Supabase.

[Your specific request]
```

**2. ×ª×”×™×” ×¡×¤×¦×™×¤×™:**
```
âŒ "Create an API for users"
âœ… "Create a POST /api/users endpoint that:
   - Accepts: { email, password, full_name }
   - Validates email format
   - Hashes password with bcrypt
   - Inserts to Supabase users table
   - Returns: { user, token }"
```

**3. ×‘×§×© ×“×•×’×××•×ª:**
```
Create this function AND show me an example of how to use it.
```

**4. ×“×¨×•×© Error Handling:**
```
Add try/catch blocks and return meaningful error messages.
```

**5. ×‘×§×© Comments:**
```
Add JSDoc comments to all functions.
```

---

### Template Prompts

**Backend API Endpoint:**
```
Create a [GET/POST/PUT/DELETE] endpoint at /api/[path].

Requirements:
- Input: [describe]
- Validation: [describe]
- Database: [table/operation]
- Output: [describe]
- Error handling: [cases]
- Authorization: [yes/no]

Add JSDoc comments and example usage.
```

**Frontend Component:**
```
Create a React component [ComponentName] that:

Features:
- [feature 1]
- [feature 2]

Props:
- [prop1]: [type] - [description]

State:
- [state1]: [type] - [description]

Styling: Use Tailwind CSS with [color scheme/style]

Handle loading and error states.
```

**Database Query:**
```
Write a Supabase query that:
- Table: [table_name]
- Operation: [select/insert/update/delete]
- Filters: [describe]
- Joins: [if needed]
- Returns: [describe]

Include error handling.
```

**Job/Cron:**
```
Create a scheduled job that runs [frequency].

Tasks:
1. [step 1]
2. [step 2]
3. [step 3]

Error handling:
- If [error] â†’ [action]

Logging:
- Log start/end
- Log errors with context

Use node-cron for scheduling.
```

---

## 9. Definition of Done

### Global Definition of Done

**×›×œ feature ×—×™×™×‘ ×œ×¢×‘×•×¨:**

âœ… **Works:** ×”×¤×™×¦'×¨ ×¢×•×‘×“ ×›××• ×©×¦×¨×™×š  
âœ… **Tested:** × ×‘×“×§ ×™×“× ×™×ª ×œ×¤×—×•×ª 3 ×¤×¢××™×  
âœ… **Error Handling:** ×˜×™×¤×•×œ ×‘×©×’×™××•×ª  
âœ… **Logged:** Events ××ª×•×¢×“×™×  
âœ… **Documented:** ×™×© comment/readme  
âœ… **Committed:** Git commit ×¢× ×”×•×“×¢×” ×‘×¨×•×¨×”  

---

### Per-Phase Definition of Done

**Week 1-2 (Foundation):**
- âœ… User ×™×›×•×œ ×œ×”×™×¨×©× ×•×œ×”×ª×—×‘×¨
- âœ… User ×™×›×•×œ ×œ×—×‘×¨ Google Ads account
- âœ… Tokens × ×©××¨×™× ××•×¦×¤× ×™×
- âœ… Database Schema ××œ×
- âœ… Basic Dashboard ××•×¦×’

**Week 3-4 (Data & Detection):**
- âœ… Clicks × ××¡×¤×™× ×›×œ 6 ×©×¢×•×ª
- âœ… Baseline ××—×•×©×‘ ×™×•××™×ª
- âœ… 12 Detection Rules ×¢×•×‘×“×™×
- âœ… Detections × ×©××¨×™× ×‘-DB
- âœ… Cooldown + Rate Limiting ×¢×•×‘×“

**Week 5-6 (Dashboard & Reports):**
- âœ… Dashboard ××¦×™×’ × ×ª×•× ×™× ×××™×ª×™×™×
- âœ… Quiet Index ××—×•×©×‘ × ×›×•×Ÿ
- âœ… Monthly Report × ×•×¦×¨ ××•×˜×•××˜×™×ª
- âœ… WhatsApp × ×©×œ×— ×‘×”×¦×œ×—×”
- âœ… Settings ×¢×•×‘×“×•×ª

**Week 7-8 (Testing):**
- âœ… ××¤×¡ ×‘××’×™× ×§×¨×™×˜×™×™×
- âœ… Performance ×˜×•×‘ (< 2s load)
- âœ… Errors ××˜×•×¤×œ×™× × ×›×•×Ÿ
- âœ… Logging ××§×™×£
- âœ… Documentation ××œ×

**Week 9 (Launch):**
- âœ… ×œ×§×•×— ×¨××©×•×Ÿ ×¤×¢×™×œ
- âœ… Feedback × ××¡×£
- âœ… Production stable
- âœ… Support system ×¤×¢×™×œ

---

## 10. Troubleshooting

### ×‘×¢×™×•×ª × ×¤×•×¦×•×ª ×•×¤×ª×¨×•× ×•×ª

**×‘×¢×™×”: Google Ads API ××—×–×™×¨ 401 Unauthorized**
```
×¤×ª×¨×•×Ÿ:
1. ×‘×“×•×§ ×©×”-Developer Token × ×›×•×Ÿ
2. ×‘×“×•×§ ×©×”Refresh Token ×œ× ×¤×’
3. ×¨×¢× ×Ÿ ××ª ×”Token:
   const newToken = await getAccessToken(refreshToken);
4. ×× ×¢×“×™×™×Ÿ ×œ× ×¢×•×‘×“ - ×‘×§×© ××”×œ×§×•×— ×œ×—×‘×¨ ××—×“×©
```

**×‘×¢×™×”: Supabase RLS ××•× ×¢ ×’×™×©×”**
```
×¤×ª×¨×•×Ÿ:
1. ×‘×“×•×§ ×©×™×© Authorization header
2. ×‘×“×•×§ ××ª ×”Policy:
   SELECT * FROM policies WHERE tablename = 'your_table';
3. ×× Policy ×—×¡×¨ - ×”×•×¡×£:
   CREATE POLICY "Policy name" ON table FOR SELECT USING (condition);
```

**×‘×¢×™×”: Jobs ×œ× ×¨×¦×™×**
```
×¤×ª×¨×•×Ÿ:
1. ×‘×“×•×§ ×©×”×©×¨×ª ×¨×¥:
   pm2 status (if using PM2)
2. ×‘×“×•×§ logs:
   tail -f combined.log
3. ×”×¨×¥ ×™×“× ×™×ª ×œ×‘×“×™×§×”:
   node backend/jobs/ingest-clicks.js
```

**×‘×¢×™×”: Dashboard ×œ× ××¦×™×’ × ×ª×•× ×™×**
```
×¤×ª×¨×•×Ÿ:
1. ×¤×ª×— Console â†’ Network
2. ×‘×“×•×§ ××ª ×”-API call
3. ×× 401 â†’ Token ×¤×’, ×¨×¢× ×Ÿ session
4. ×× 403 â†’ RLS issue
5. ×× 404 â†’ ×‘×“×•×§ route
6. ×× 500 â†’ ×‘×“×•×§ Backend logs
```

**×‘×¢×™×”: Baseline ×œ× ××—×•×©×‘**
```
×¤×ª×¨×•×Ÿ:
1. ×‘×“×•×§ ×©×™×© ××¡×¤×™×§ × ×ª×•× ×™× (7 ×™××™× + 100 events)
2. ×”×¨×¥ calculate-baseline ×™×“× ×™×ª
3. ×‘×“×•×§ detection_state:
   SELECT * FROM detection_state WHERE ad_account_id = 'uuid';
4. ×× learning_mode = true â†’ ×—×›×” ×¢×•×“ ×™××™×
```

**×‘×¢×™×”: WhatsApp ×œ× × ×©×œ×—**
```
×¤×ª×¨×•×Ÿ:
1. ×‘×“×•×§ ×©××¡×¤×¨ ×”×˜×œ×¤×•×Ÿ ×‘×¤×•×¨××˜ +972...
2. ×‘×“×•×§ ×©×”Access Token ×ª×§×£
3. ×‘×“×•×§ ×‘-Meta Business Suite â†’ WhatsApp Manager â†’ Insights
4. × ×¡×” ×œ×©×œ×•×— ×”×•×“×¢×” ×™×“× ×™×ª ×“×¨×š WhatsApp Manager
```

---

## ğŸ¯ ×¡×™×›×•× ×ª×•×›× ×™×ª ×”-60 ×™×•×

### ××” ×‘× ×™× ×•?

âœ… **Week 1-2:** ×ª×©×ª×™×ª ××œ××” (Auth + DB + OAuth)  
âœ… **Week 3-4:** Data Flow + Detection Engine  
âœ… **Week 5-6:** Dashboard + Reports + WhatsApp  
âœ… **Week 7-8:** Testing + Polish + Performance  
âœ… **Week 9:** First Client + Launch  

### ×”×¦×¢×“ ×”×‘×?

**××—×¨×™ ×©×™×© ×œ×š ××ª 4 ×”××¡××›×™×:**
1. ×§×¨× ×”×›×œ ×‘×¢×™×•×Ÿ
2. ×©××œ ×©××œ×•×ª
3. **×ª×ª×—×™×œ ×‘×™×•× 1!**

---

## ğŸ“ **×ª××™×›×” ×•×œ×•×•×™**

**×‘×›×œ ×©×œ×‘:**
- ×›×ª×•×‘ ×œ×™ "×™×•× X" â†’ ×× ×™ ××œ×•×•×” ××•×ª×š
- ×©××œ ×©××œ×•×ª â†’ ×× ×™ ×¢×•× ×” ××™×“
- ×ª×§×•×¢? â†’ ×× ×™ ×¢×•×–×¨ ×œ×¤×ª×•×¨

**×× ×™ ××™×ª×š ×¢×“ ×”×¡×•×£!** ğŸš€

---

**×–×” ×–×”! ×”××¡××š ×”×©×œ×™×©×™ ××•×›×Ÿ!**

×ª×›×ª×•×‘ **"×”×‘×"** ×œ××¡××š 4 (×”××—×¨×•×Ÿ), ××• ×©××œ ×©××œ×•×ª! ğŸ’ª
